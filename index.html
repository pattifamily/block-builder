<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Block Adventure üß±</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      min-height: 100vh;
      background: linear-gradient(180deg, #1a1a2e 0%, #16213e 50%);
      font-family: 'Comic Sans MS', cursive;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 10px;
      user-select: none;
    }

    h1 { color: #FFD700; font-size: 2rem; text-shadow: 2px 2px 0 #000; margin-bottom: 5px; }

    .menu-screen {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
      padding: 30px;
    }

    .menu-screen.hidden { display: none; }

    .level-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin-top: 20px;
    }

    .level-btn {
      width: 100px;
      height: 100px;
      border: 4px solid #444;
      border-radius: 15px;
      background: linear-gradient(180deg, #4a4a4a 0%, #2a2a2a 100%);
      color: white;
      font-size: 1.5rem;
      font-family: inherit;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .level-btn:hover:not(:disabled) { transform: scale(1.05); border-color: #FFD700; }
    .level-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .level-btn.completed { border-color: #4CAF50; background: linear-gradient(180deg, #2e5a2e 0%, #1a3a1a 100%); }
    .level-btn.current { border-color: #FFD700; box-shadow: 0 0 15px #FFD700; }

    .level-btn small { font-size: 0.8rem; margin-top: 5px; color: #aaa; }

    .game-info {
      display: none;
      gap: 20px;
      margin-bottom: 10px;
      align-items: center;
      flex-wrap: wrap;
      justify-content: center;
    }

    .game-info.show { display: flex; }

    .health-bar, .coin-display {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .health-label, .coin-label { font-size: 1.2rem; font-weight: bold; }
    .health-label { color: #ff4444; }
    .coin-label { color: #FFD700; }

    .health-container, .coin-container {
      width: 150px;
      height: 20px;
      background: #333;
      border-radius: 10px;
      overflow: hidden;
      border: 2px solid #555;
    }

    .health-fill {
      height: 100%;
      background: linear-gradient(180deg, #ff6666 0%, #ff0000 50%, #cc0000 100%);
      transition: width 0.3s;
      border-radius: 10px;
    }

    .coin-fill {
      height: 100%;
      background: linear-gradient(180deg, #FFE066 0%, #FFD700 50%, #FFA500 100%);
      border-radius: 10px;
      transition: width 0.3s;
    }

    .level-display, .score-display {
      color: white;
      font-size: 1.2rem;
    }

    .game-container {
      display: none;
      gap: 15px;
      align-items: flex-start;
    }

    .game-container.show { display: flex; }

    .toolbar {
      background: rgba(0, 0, 0, 0.8);
      padding: 10px;
      border-radius: 15px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .toolbar h3 { color: white; text-align: center; font-size: 1rem; margin-bottom: 5px; }

    .block-btn {
      width: 50px;
      height: 50px;
      border: 3px solid transparent;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 1.5rem;
    }

    .block-btn:hover { transform: scale(1.1); }
    .block-btn.selected { border-color: yellow; box-shadow: 0 0 15px yellow; }

    .grass { background: linear-gradient(180deg, #4CAF50 0%, #4CAF50 40%, #8B4513 40%, #8B4513 100%); }
    .stone { background: #808080; }
    .dirt { background: #8B4513; }
    .wood { background: linear-gradient(90deg, #8B4513 0%, #A0522D 50%, #8B4513 100%); }
    .leaves { background: #228B22; }
    .sky { background: #87CEEB; border: 2px dashed #fff; }
    .coin { background: #FFD700; border-radius: 50%; border: 3px solid #FFA500; }

    .world-container { position: relative; }

    .world {
      display: grid;
      grid-template-columns: repeat(15, 30px);
      grid-template-rows: repeat(12, 30px);
      border: 4px solid #444;
      border-radius: 5px;
      background: #87CEEB;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
      position: relative;
    }

    .cell {
      width: 30px;
      height: 30px;
      border: 1px solid rgba(0,0,0,0.1);
      cursor: pointer;
      position: relative;
    }

    .cell.grass { background: linear-gradient(180deg, #4CAF50 0%, #4CAF50 40%, #8B4513 40%, #8B4513 100%); }
    .cell.stone { background: #808080; }
    .cell.dirt { background: #8B4513; }
    .cell.wood { background: linear-gradient(90deg, #8B4513 0%, #A0522D 50%, #8B4513 100%); }
    .cell.leaves { background: #228B22; }
    .cell.sky { background: #87CEEB; }
    .cell.coin::after {
      content: 'ü™ô';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 18px;
    }

    .player {
      position: absolute;
      width: 24px;
      height: 24px;
      background: #FFD700;
      border-radius: 50%;
      border: 3px solid #FFA500;
      z-index: 10;
      transition: left 0.1s, top 0.1s;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
    }

    .monster {
      position: absolute;
      width: 26px;
      height: 26px;
      z-index: 9;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      transition: left 0.3s, top 0.3s;
      cursor: pointer;
    }

    .coin-item {
      position: absolute;
      width: 20px;
      height: 20px;
      z-index: 8;
      font-size: 16px;
      animation: spin 1s infinite linear;
    }

    @keyframes spin {
      0% { transform: rotateY(0deg); }
      100% { transform: rotateY(360deg); }
    }

    .controls {
      margin-top: 10px;
      display: none;
      gap: 10px;
    }

    .controls.show { display: flex; }

    .btn {
      padding: 8px 16px;
      font-size: 0.9rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-family: inherit;
      transition: all 0.2s;
    }

    .btn-back { background: #666; color: white; }
    .btn-back:hover { background: #888; }

    .instructions {
      margin-top: 10px;
      background: rgba(0,0,0,0.5);
      padding: 10px;
      border-radius: 10px;
      color: white;
      max-width: 500px;
      font-size: 0.9rem;
      text-align: center;
      display: none;
    }

    .instructions.show { display: block; }

    .joystick-container, .attack-btn, .jump-btn {
      display: none;
    }

    @media (pointer: coarse) {
      .joystick-container, .attack-btn, .jump-btn { display: flex; }
    }

    .joystick-container {
      position: fixed;
      bottom: 30px;
      left: 30px;
      width: 120px;
      height: 120px;
      background: rgba(255,255,255,0.2);
      border-radius: 50%;
      touch-action: none;
      z-index: 50;
    }

    .joystick-knob {
      position: absolute;
      width: 50px;
      height: 50px;
      background: rgba(255,255,255,0.8);
      border-radius: 50%;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
    }

    .attack-btn, .jump-btn {
      position: fixed;
      bottom: 50px;
      width: 70px;
      height: 70px;
      border-radius: 50%;
      border: 4px solid white;
      font-size: 1.5rem;
      z-index: 50;
      touch-action: none;
    }

    .attack-btn {
      right: 30px;
      background: rgba(255, 68, 68, 0.8);
      color: white;
    }

    .jump-btn {
      right: 120px;
      background: rgba(76, 175, 80, 0.8);
      color: white;
    }
  </style>
</head>
<body>
  <h1>üß± Block Adventure</h1>

  <!-- Menu Screen -->
  <div class="menu-screen" id="menuScreen">
    <h2 style="color: white;">Choose a Level!</h2>
    <div class="level-grid" id="levelGrid"></div>
    <p style="color: #aaa; margin-top: 20px;">ü™ô Coins: <span id="totalCoins">0</span></p>
  </div>

  <!-- Game Info -->
  <div class="game-info" id="gameInfo">
    <div class="health-bar">
      <span class="health-label">‚ù§Ô∏è</span>
      <div class="health-container"><div class="health-fill" id="healthFill"></div></div>
    </div>
    <div class="coin-display">
      <span class="coin-label">ü™ô</span>
      <div class="coin-container"><div class="coin-fill" id="coinFill"></div></div>
    </div>
    <div class="level-display">Level: <span id="levelNum">1</span></div>
    <div class="score-display">Kills: <span id="kills">0</span>/<span id="neededKills">5</span></div>
  </div>

  <!-- Game Container -->
  <div class="game-container" id="gameContainer">
    <div class="toolbar">
      <h3>Blocks</h3>
      <button class="block-btn grass selected" data-block="grass"></button>
      <button class="block-btn stone" data-block="stone"></button>
      <button class="block-btn dirt" data-block="dirt"></button>
      <button class="block-btn wood" data-block="wood"></button>
      <button class="block-btn leaves" data-block="leaves"></button>
      <button class="block-btn sky" data-block="sky"></button>
    </div>
    <div class="world-container">
      <div class="world" id="world"></div>
      <div class="player" id="player">üòä</div>
    </div>
  </div>

  <div class="controls" id="controls">
    <button class="btn btn-back" onclick="backToMenu()">‚¨ÖÔ∏è Back to Levels</button>
  </div>

  <div class="instructions" id="instructions">
    <strong>Controls:</strong> Arrow Keys/WASD to move, Space to jump. Click to place blocks. Click monsters to attack!
  </div>

  <div class="joystick-container" id="joystick"><div class="joystick-knob" id="joystickKnob"></div></div>
  <div class="attack-btn" id="attackBtn">‚öîÔ∏è</div>
  <div class="jump-btn" id="jumpBtn">‚¨ÜÔ∏è</div>

  <script>
    // Game state
    const world = document.getElementById('world');
    const player = document.getElementById('player');
    const menuScreen = document.getElementById('menuScreen');
    const gameInfo = document.getElementById('gameInfo');
    const gameContainer = document.getElementById('gameContainer');
    const controls = document.getElementById('controls');
    const instructions = document.getElementById('instructions');
    const levelGrid = document.getElementById('levelGrid');
    const totalCoinsDisplay = document.getElementById('totalCoins');

    let selectedBlock = 'grass';
    const rows = 12;
    const cols = 15;
    let playerX = 7;
    let playerY = 8;
    let health = 100;
    let currentLevel = 1;
    let totalCoins = 0;
    let unlockedLevels = 1;
    let kills = 0;
    let monsters = [];
    let coinItems = [];
    let gameRunning = false;
    let velocityY = 0;
    const gravity = 0.3;
    const jumpStrength = -1.5;
    let isGrounded = false;
    let canDoubleJump = true;

    // Level settings
    const levelSettings = {
      1: { monsters: 3, coins: 5, neededKills: 3 },
      2: { monsters: 4, coins: 7, neededKills: 4 },
      3: { monsters: 5, coins: 8, neededKills: 5 },
      4: { monsters: 6, coins: 10, neededKills: 6 },
      5: { monsters: 7, coins: 12, neededKills: 7 },
      6: { monsters: 8, coins: 15, neededKills: 8 },
      7: { monsters: 10, coins: 18, neededKills: 10 },
      8: { monsters: 12, coins: 20, neededKills: 12 },
      9: { monsters: 15, coins: 25, neededKills: 15 }
    };

    // Save/Load
    function saveProgress() {
      localStorage.setItem('blockAdventure_unlocked', unlockedLevels);
      localStorage.setItem('blockAdventure_coins', totalCoins);
    }

    function loadProgress() {
      const saved = localStorage.getItem('blockAdventure_unlocked');
      const coins = localStorage.getItem('blockAdventure_coins');
      if (saved) unlockedLevels = parseInt(saved);
      if (coins) totalCoins = parseInt(coins);
      totalCoinsDisplay.textContent = totalCoins;
    }

    // Create level buttons
    function createLevelButtons() {
      levelGrid.innerHTML = '';
      for (let i = 1; i <= 9; i++) {
        const btn = document.createElement('button');
        btn.className = 'level-btn';
        btn.innerHTML = `${i}<small>${levelSettings[i].monsters} üßü</small>`;
        
        if (i > unlockedLevels) {
          btn.disabled = true;
        } else if (i < unlockedLevels) {
          btn.classList.add('completed');
        } else if (i === unlockedLevels) {
          btn.classList.add('current');
        }
        
        btn.onclick = () => startLevel(i);
        levelGrid.appendChild(btn);
      }
    }

    function startLevel(level) {
      currentLevel = level;
      kills = 0;
      monsters = [];
      coinItems = [];
      
      // Show game
      menuScreen.classList.add('hidden');
      gameInfo.classList.add('show');
      gameContainer.classList.add('show');
      controls.classList.add('show');
      instructions.classList.add('show');
      
      document.getElementById('levelNum').textContent = level;
      document.getElementById('kills').textContent = kills;
      document.getElementById('neededKills').textContent = levelSettings[level].neededKills;
      
      createWorld();
      spawnMonsters(levelSettings[level].monsters);
      spawnCoins(levelSettings[level].coins);
      resetPlayer();
      
      gameRunning = true;
    }

    function backToMenu() {
      gameRunning = false;
      menuScreen.classList.remove('hidden');
      gameInfo.classList.remove('show');
      gameContainer.classList.remove('show');
      controls.classList.remove('show');
      instructions.classList.remove('show');
      createLevelButtons();
    }

    function createWorld() {
      world.innerHTML = '';
      for (let row = 0; row < rows; row++) {
        for (let col = 0; col < cols; col++) {
          const cell = document.createElement('div');
          cell.className = 'cell';
          if (row >= rows - 2) {
            cell.classList.add('grass');
            cell.dataset.block = 'grass';
          } else {
            cell.classList.add('sky');
            cell.dataset.block = 'sky';
          }
          cell.addEventListener('click', () => placeBlock(cell));
          world.appendChild(cell);
        }
      }
    }

    function placeBlock(cell) {
      if (!gameRunning) return;
      cell.className = 'cell ' + selectedBlock;
      cell.dataset.block = selectedBlock;
    }

    // Block selection
    document.querySelectorAll('.block-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelector('.block-btn.selected').classList.remove('selected');
        btn.classList.add('selected');
        selectedBlock = btn.dataset.block;
      });
    });

    function resetPlayer() {
      playerX = 7;
      playerY = 8;
      velocityY = 0;
      isGrounded = false;
      canDoubleJump = true;
      updatePlayerPosition();
    }

    function updatePlayerPosition() {
      player.style.left = (playerX * 30 + 3) + 'px';
      player.style.top = (playerY * 30 + 3) + 'px';
    }

    // Movement
    document.addEventListener('keydown', (e) => {
      if (!gameRunning) return;
      
      let newX = playerX;
      if (e.key === 'ArrowLeft' || e.key === 'a') newX--;
      if (e.key === 'ArrowRight' || e.key === 'd') newX++;
      
      if (newX >= 0 && newX < cols) {
        playerX = newX;
        updatePlayerPosition();
        checkCollisions();
      }
      
      if (e.code === 'Space') {
        e.preventDefault();
        if (isGrounded) {
          velocityY = jumpStrength;
          isGrounded = false;
          canDoubleJump = true;
        } else if (canDoubleJump) {
          // Double jump!
          velocityY = jumpStrength;
          canDoubleJump = false;
          // Visual effect for double jump
          player.style.transform = 'scale(1.2)';
          setTimeout(() => player.style.transform = 'scale(1)', 150);
        }
      }
    });

    // Physics
    setInterval(() => {
      if (!gameRunning) return;
      
      let targetY = playerY + velocityY;
      const groundRow = rows - 2;
      
      if (targetY > groundRow) {
        playerY = groundRow;
        velocityY = 0;
        isGrounded = true;
        canDoubleJump = true; // Reset double jump when landing
      } else {
        playerY = targetY;
        velocityY += gravity;
      }
      
      updatePlayerPosition();
      checkCollisions();
    }, 100);

    function getCell(x, y) {
      if (x < 0 || x >= cols || y < 0 || y >= rows) return null;
      return world.children[y * cols + x];
    }

    function checkCollisions() {
      // Check monster collision
      monsters.forEach(m => {
        const mx = parseInt(m.dataset.x);
        const my = parseInt(m.dataset.y);
        if (mx === playerX && my === playerY) {
          takeDamage(15);
          // Bounce monster away
          m.dataset.x = Math.max(0, Math.min(cols - 1, mx + (Math.random() > 0.5 ? 2 : -2)));
          m.dataset.y = Math.max(0, Math.min(rows - 1, my + (Math.random() > 0.5 ? 2 : -2)));
          m.style.left = (m.dataset.x * 30 + 2) + 'px';
          m.style.top = (m.dataset.y * 30 + 2) + 'px';
        }
      });

      // Check coin collection
      coinItems.forEach((coin, i) => {
        const cx = parseInt(coin.dataset.x);
        const cy = parseInt(coin.dataset.y);
        if (cx === playerX && cy === playerY) {
          // Coin collected animation
          coin.style.transform = 'scale(1.5)';
          coin.style.opacity = '0';
          coin.style.transition = 'all 0.2s';
          setTimeout(() => {
            coin.remove();
          }, 200);
          coinItems.splice(i, 1);
          updateCoinDisplay();
        }
      });
    }

    function takeDamage(amount) {
      health -= amount;
      document.getElementById('healthFill').style.width = health + '%';
      player.style.filter = 'brightness(2) sepia(1) hue-rotate(-50deg) saturate(5)';
      setTimeout(() => player.style.filter = 'none', 200);
      
      if (health <= 0) {
        alert('Game Over! Try again!');
        backToMenu();
      }
    }

    function updateCoinDisplay() {
      const coinsCollected = levelSettings[currentLevel].coins - coinItems.length;
      document.getElementById('coinFill').style.width = (coinsCollected / levelSettings[currentLevel].coins * 100) + '%';
    }

    function spawnMonsters(count) {
      const types = ['üßü', 'üíÄ', 'üëπ'];
      for (let i = 0; i < count; i++) {
        const type = types[Math.floor(Math.random() * types.length)];
        let x, y;
        do {
          x = Math.floor(Math.random() * cols);
          y = Math.floor(Math.random() * (rows - 3));
        } while (Math.abs(x - playerX) < 3 && Math.abs(y - playerY) < 3);
        
        const monster = document.createElement('div');
        monster.className = 'monster';
        monster.textContent = type;
        monster.dataset.x = x;
        monster.dataset.y = y;
        monster.style.left = (x * 30 + 2) + 'px';
        monster.style.top = (y * 30 + 2) + 'px';
        monster.onclick = () => attackMonster(monster);
        world.parentElement.appendChild(monster);
        monsters.push(monster);
      }
    }

    function spawnCoins(count) {
      for (let i = 0; i < count; i++) {
        let x, y;
        do {
          x = Math.floor(Math.random() * cols);
          y = Math.floor(Math.random() * (rows - 3));
        } while (Math.abs(x - playerX) < 2 && Math.abs(y - playerY) < 2);
        
        const coin = document.createElement('div');
        coin.className = 'coin-item';
        coin.textContent = 'ü™ô';
        coin.dataset.x = x;
        coin.dataset.y = y;
        coin.style.left = (x * 30 + 5) + 'px';
        coin.style.top = (y * 30 + 5) + 'px';
        world.parentElement.appendChild(coin);
        coinItems.push(coin);
      }
      updateCoinDisplay();
    }

    function attackMonster(monster) {
      if (!gameRunning) return;
      const mx = parseInt(monster.dataset.x);
      const my = parseInt(monster.dataset.y);
      
      if (Math.abs(mx - playerX) <= 1 && Math.abs(my - playerY) <= 1) {
        monster.remove();
        const idx = monsters.indexOf(monster);
        if (idx > -1) monsters.splice(idx, 1);
        
        kills++;
        document.getElementById('kills').textContent = kills;
        
        // Check level complete
        if (kills >= levelSettings[currentLevel].neededKills) {
          setTimeout(() => {
            if (currentLevel >= unlockedLevels && currentLevel < 9) {
              unlockedLevels = currentLevel + 1;
              totalCoins += levelSettings[currentLevel].coins - coinItems.length;
              saveProgress();
            } else if (currentLevel < 9) {
              totalCoins += levelSettings[currentLevel].coins - coinItems.length;
              saveProgress();
            }
            
            if (currentLevel < 9) {
              alert(`Level ${currentLevel} Complete! üèÜ\nü™ô Coins earned: ${levelSettings[currentLevel].coins - coinItems.length}`);
              startLevel(currentLevel + 1);
            } else {
              alert('You beat all levels! üéâ\nThanks for playing!');
              backToMenu();
            }
          }, 500);
        }
      }
    }

    // Touch controls
    const joystick = document.getElementById('joystick');
    const joystickKnob = document.getElementById('joystickKnob');
    const attackBtn = document.getElementById('attackBtn');
    const jumpBtn = document.getElementById('jumpBtn');
    let joystickX = 0, joystickY = 0;

    joystick.addEventListener('touchmove', (e) => {
      e.preventDefault();
      const touch = e.touches[0];
      const rect = joystick.getBoundingClientRect();
      let dx = touch.clientX - (rect.left + rect.width/2);
      let dy = touch.clientY - (rect.top + rect.height/2);
      const dist = Math.sqrt(dx*dx + dy*dy);
      const maxDist = 35;
      if (dist > maxDist) { dx = dx/dist*maxDist; dy = dy/dist*maxDist; }
      joystickKnob.style.transform = `translate(calc(-50% + ${dx}px), calc(-50% + ${dy}px))`;
      joystickX = dx/maxDist;
      joystickY = dy/maxDist;
    });

    joystick.addEventListener('touchend', () => {
      joystickX = 0; joystickY = 0;
      joystickKnob.style.transform = 'translate(-50%, -50%)';
    });

    setInterval(() => {
      if (!gameRunning || (joystickX === 0 && joystickY === 0)) return;
      let newX = playerX;
      if (joystickX < -0.3) newX--;
      if (joystickX > 0.3) newX++;
      if (newX >= 0 && newX < cols) {
        playerX = newX;
        updatePlayerPosition();
        checkCollisions();
      }
    }, 100);

    jumpBtn.addEventListener('touchstart', (e) => {
      e.preventDefault();
      if (gameRunning) {
        if (isGrounded) {
          velocityY = jumpStrength;
          isGrounded = false;
          canDoubleJump = true;
        } else if (canDoubleJump) {
          velocityY = jumpStrength;
          canDoubleJump = false;
        }
      }
    });

    attackBtn.addEventListener('touchstart', (e) => {
      e.preventDefault();
      monsters.forEach(m => attackMonster(m));
    });

    // Initialize
    loadProgress();
    createLevelButtons();
  </script>
</body>
</html>
